<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Classification Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- D3.js for wordcloud -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- D3 Wordcloud -->
    <script src="https://cdn.jsdelivr.net/gh/jasondavies/d3-cloud@1.2.5/build/d3.layout.cloud.js"></script>
    <!-- PapaParse for CSV parsing -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <style>
        body {
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        .wordcloud {
            width: 100%;
            height: 400px;
        }
        .chart-container {
            height: 400px;
        }
        .tab-content {
            padding: 20px;
            border-left: 1px solid #dee2e6;
            border-right: 1px solid #dee2e6;
            border-bottom: 1px solid #dee2e6;
        }
        .filter-container {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            text-align: center;
            padding-top: 20%;
        }
        .sample-data-button {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="loading">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p>Processing data...</p>
    </div>

    <div class="container">
        <h1 class="text-center mb-4">Company Classification Dashboard</h1>
        
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="card-title mb-0">Data Import</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="csvFile" class="form-label">Upload CSV file with classification data:</label>
                            <div class="input-group">
                                <input type="file" class="form-control" id="csvFile" accept=".csv">
                                <button class="btn btn-success" id="loadCsvBtn" type="button">Load Data</button>
                                <button class="btn btn-info sample-data-button" id="loadSampleBtn" type="button">Load Sample Data</button>
                            </div>
                            <small class="text-muted">Expected columns: Company Name, Company URL, vertical, vertical_detail</small>
                        </div>
                        <div id="uploadStatus" class="alert alert-info d-none"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="dashboardContent" class="d-none">
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="card-title mb-0">Filters</h5>
                        </div>
                        <div class="card-body filter-container">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="verticalFilter" class="form-label">Vertical Category:</label>
                                    <select class="form-select" id="verticalFilter">
                                        <option value="all">All Verticals</option>
                                        <optgroup label="BIOTECH/LIFE SCIENCES VERTICALS">
                                            <option value="Therapeutics">Therapeutics</option>
                                            <option value="Research Tools & Lab Equipment">Research Tools & Lab Equipment</option>
                                            <option value="Diagnostics">Diagnostics</option>
                                            <option value="Medical Devices">Medical Devices</option>
                                            <option value="CROs & CDMOs">CROs & CDMOs</option>
                                            <option value="Bioinformatics & Computational Tools">Bioinformatics & Computational Tools</option>
                                            <option value="Digital Health & Health IT">Digital Health & Health IT</option>
                                            <option value="Clinical & Regulatory Consulting">Clinical & Regulatory Consulting</option>
                                            <option value="General Biotech">General Biotech</option>
                                            <option value="Industrial Biotech">Industrial Biotech</option>
                                        </optgroup>
                                        <optgroup label="ACADEMIC VERTICAL">
                                            <option value="Academic & Research Institutions">Academic & Research Institutions</option>
                                        </optgroup>
                                        <optgroup label="NON-BIOTECH VERTICALS">
                                            <option value="Healthcare Services">Healthcare Services</option>
                                            <option value="Technology/IT">Technology/IT</option>
                                            <option value="Professional Services">Professional Services</option>
                                            <option value="Manufacturing">Manufacturing</option>
                                            <option value="Consumer Goods">Consumer Goods</option>
                                            <option value="Financial Services">Financial Services</option>
                                            <option value="Energy">Energy</option>
                                            <option value="Media & Entertainment">Media & Entertainment</option>
                                            <option value="Government & Public Sector">Government & Public Sector</option>
                                            <option value="Environmental Services">Environmental Services</option>
                                            <option value="Real Estate & Construction">Real Estate & Construction</option>
                                            <option value="Education & Training">Education & Training</option>
                                            <option value="Transportation & Logistics">Transportation & Logistics</option>
                                            <option value="Non-Profit & Advocacy">Non-Profit & Advocacy</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <div class="col-md-8 mb-3">
                                    <label for="detailSearch" class="form-label">Search in Vertical Details:</label>
                                    <input type="text" class="form-control" id="detailSearch" placeholder="Enter keywords (e.g., 'antibody', 'cancer', 'platform')">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <button class="btn btn-primary" id="applyFiltersBtn">Apply Filters</button>
                                    <button class="btn btn-secondary" id="resetFiltersBtn">Reset Filters</button>
                                    <span class="ms-3" id="resultsCount"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="data-tab" data-bs-toggle="tab" data-bs-target="#data" type="button" role="tab" aria-controls="data" aria-selected="true">Data Table</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="charts-tab" data-bs-toggle="tab" data-bs-target="#charts" type="button" role="tab" aria-controls="charts" aria-selected="false">Charts</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="wordcloud-tab" data-bs-toggle="tab" data-bs-target="#wordcloud" type="button" role="tab" aria-controls="wordcloud" aria-selected="false">Word Cloud</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="insights-tab" data-bs-toggle="tab" data-bs-target="#insights" type="button" role="tab" aria-controls="insights" aria-selected="false">Insights</button>
                </li>
            </ul>
            
            <div class="tab-content" id="dashboardTabsContent">
                <!-- Data Table Tab -->
                <div class="tab-pane fade show active" id="data" role="tabpanel" aria-labelledby="data-tab">
                    <div class="table-responsive">
                        <table id="companiesTable" class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>Company Name</th>
                                    <th>URL</th>
                                    <th>Vertical</th>
                                    <th>Vertical Detail</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Table data will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Charts Tab -->
                <div class="tab-pane fade" id="charts" role="tabpanel" aria-labelledby="charts-tab">
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Companies by Vertical</h5>
                                </div>
                                <div class="card-body chart-container">
                                    <canvas id="verticalChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Category Distribution</h5>
                                </div>
                                <div class="card-body chart-container">
                                    <canvas id="categoryChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Top Terms in Vertical Details</h5>
                                </div>
                                <div class="card-body chart-container">
                                    <canvas id="termsChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Word Cloud Tab -->
                <div class="tab-pane fade" id="wordcloud" role="tabpanel" aria-labelledby="wordcloud-tab">
                    <div class="row">
                        <div class="col-md-12 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Vertical Details Word Cloud</h5>
                                </div>
                                <div class="card-body wordcloud-container">
                                    <div id="detailsWordcloud" class="wordcloud"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Biotech Verticals Word Cloud</h5>
                                </div>
                                <div class="card-body wordcloud-container">
                                    <div id="biotechWordcloud" class="wordcloud"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Non-Biotech Verticals Word Cloud</h5>
                                </div>
                                <div class="card-body wordcloud-container">
                                    <div id="nonBiotechWordcloud" class="wordcloud"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Insights Tab -->
                <div class="tab-pane fade" id="insights" role="tabpanel" aria-labelledby="insights-tab">
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Key Statistics</h5>
                                </div>
                                <div class="card-body">
                                    <div id="keyStats">
                                        <!-- Stats will be inserted here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Common Terms by Vertical</h5>
                                </div>
                                <div class="card-body">
                                    <div id="verticalTerms">
                                        <select class="form-select mb-3" id="verticalTermsSelect">
                                            <!-- Options will be inserted here -->
                                        </select>
                                        <div id="verticalTermsList"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Dashboard JS -->
    <script>
        // Global variables
        let companiesData = [];
        let filteredData = [];
        let dataTable;
        let verticalChart, categoryChart, termsChart;
        let detailsWordcloud, biotechWordcloud, nonBiotechWordcloud;

        // Define vertical categories
        const biotechVerticals = [
            "Therapeutics",
            "Research Tools & Lab Equipment",
            "Diagnostics",
            "Medical Devices",
            "CROs & CDMOs",
            "Bioinformatics & Computational Tools",
            "Digital Health & Health IT",
            "Clinical & Regulatory Consulting",
            "General Biotech",
            "Industrial Biotech"
        ];
        
        const academicVerticals = [
            "Academic & Research Institutions"
        ];
        
        const nonBiotechVerticals = [
            "Healthcare Services",
            "Technology/IT",
            "Professional Services",
            "Manufacturing",
            "Consumer Goods",
            "Financial Services",
            "Energy",
            "Media & Entertainment",
            "Government & Public Sector",
            "Environmental Services",
            "Real Estate & Construction",
            "Education & Training",
            "Transportation & Logistics",
            "Non-Profit & Advocacy"
        ];

        // Initialize DataTable
        function initDataTable() {
            if (dataTable) {
                dataTable.destroy();
            }
            
            dataTable = $('#companiesTable').DataTable({
                data: filteredData,
                columns: [
                    { 
                        data: 'Company Name',
                        render: function(data, type, row) {
                            if (type === 'display' && row['Company URL'] && row['Company URL'] !== 'No URL found' && row['Company URL'] !== 'Error') {
                                return '<a href="' + row['Company URL'] + '" target="_blank">' + data + '</a>';
                            }
                            return data;
                        }
                    },
                    { 
                        data: 'Company URL',
                        render: function(data, type, row) {
                            if (type === 'display' && data && data !== 'No URL found' && data !== 'Error') {
                                return '<a href="' + data + '" target="_blank">' + data + '</a>';
                            }
                            return data;
                        }
                    },
                    { data: 'vertical' },
                    { data: 'vertical_detail' }
                ],
                pageLength: 25,
                lengthMenu: [10, 25, 50, 100],
                responsive: true,
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel']
            });
        }

        // Initialize charts
        function initCharts() {
            // Destroy existing charts if they exist
            if (verticalChart) verticalChart.destroy();
            if (categoryChart) categoryChart.destroy();
            if (termsChart) termsChart.destroy();
            
            // Count companies by vertical
            const verticalCounts = {};
            filteredData.forEach(company => {
                const vertical = company.vertical;
                if (vertical) {
                    verticalCounts[vertical] = (verticalCounts[vertical] || 0) + 1;
                }
            });
            
            // Sort and prepare data for vertical chart
            const sortedVerticals = Object.entries(verticalCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 15); // Show top 15 verticals
            
            // Create vertical chart
            const verticalCtx = document.getElementById('verticalChart').getContext('2d');
            verticalChart = new Chart(verticalCtx, {
                type: 'bar',
                data: {
                    labels: sortedVerticals.map(v => v[0]),
                    datasets: [{
                        label: 'Number of Companies',
                        data: sortedVerticals.map(v => v[1]),
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Top Verticals by Number of Companies'
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Companies'
                            }
                        }
                    }
                }
            });
            
            // Count by category
            const categoryCounts = {
                'Biotech/Life Sciences': 0,
                'Academic': 0,
                'Non-Biotech': 0
            };
            
            filteredData.forEach(company => {
                const vertical = company.vertical;
                if (biotechVerticals.includes(vertical)) {
                    categoryCounts['Biotech/Life Sciences']++;
                } else if (academicVerticals.includes(vertical)) {
                    categoryCounts['Academic']++;
                } else if (nonBiotechVerticals.includes(vertical)) {
                    categoryCounts['Non-Biotech']++;
                }
            });
            
            // Create category chart
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            categoryChart = new Chart(categoryCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(categoryCounts),
                    datasets: [{
                        data: Object.values(categoryCounts),
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(255, 206, 86, 0.6)',
                            'rgba(75, 192, 192, 0.6)'
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        title: {
                            display: true,
                            text: 'Distribution by Category'
                        }
                    }
                }
            });
            
            // Extract common terms from vertical details
            const terms = {};
            const stopWords = new Set(['and', 'the', 'for', 'in', 'on', 'with', 'to', 'of', 'a', 'an']);
            
            filteredData.forEach(company => {
                if (company.vertical_detail) {
                    const words = company.vertical_detail.toLowerCase()
                        .replace(/[^\w\s]/g, '')
                        .split(/\s+/)
                        .filter(word => word.length > 2 && !stopWords.has(word));
                    
                    words.forEach(word => {
                        terms[word] = (terms[word] || 0) + 1;
                    });
                }
            });
            
            // Sort and prepare data for terms chart
            const sortedTerms = Object.entries(terms)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20); // Show top 20 terms
            
            // Create terms chart
            const termsCtx = document.getElementById('termsChart').getContext('2d');
            termsChart = new Chart(termsCtx, {
                type: 'bar',
                data: {
                    labels: sortedTerms.map(t => t[0]),
                    datasets: [{
                        label: 'Frequency',
                        data: sortedTerms.map(t => t[1]),
                        backgroundColor: 'rgba(153, 102, 255, 0.6)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Top Terms in Vertical Details'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Frequency'
                            }
                        }
                    }
                }
            });
        }

        // Initialize word clouds
        function initWordClouds() {
            // Extract terms for word clouds
            const allTerms = [];
            const biotechTerms = [];
            const nonBiotechTerms = [];
            const stopWords = new Set(['and', 'the', 'for', 'in', 'on', 'with', 'to', 'of', 'a', 'an']);
            
            filteredData.forEach(company => {
                if (company.vertical_detail) {
                    const words = company.vertical_detail.toLowerCase()
                        .replace(/[^\w\s]/g, '')
                        .split(/\s+/)
                        .filter(word => word.length > 2 && !stopWords.has(word));
                    
                    words.forEach(word => {
                        // Add to all terms
                        const existingAll = allTerms.find(t => t.text === word);
                        if (existingAll) {
                            existingAll.size += 5;
                        } else {
                            allTerms.push({ text: word, size: 10 });
                        }
                        
                        // Add to category-specific terms
                        if (biotechVerticals.includes(company.vertical)) {
                            const existingBio = biotechTerms.find(t => t.text === word);
                            if (existingBio) {
                                existingBio.size += 5;
                            } else {
                                biotechTerms.push({ text: word, size: 10 });
                            }
                        } else if (nonBiotechVerticals.includes(company.vertical) || academicVerticals.includes(company.vertical)) {
                            const existingNonBio = nonBiotechTerms.find(t => t.text === word);
                            if (existingNonBio) {
                                existingNonBio.size += 5;
                            } else {
                                nonBiotechTerms.push({ text: word, size: 10 });
                            }
                        }
                    });
                }
            });
            
            // Create word clouds
            createWordCloud('detailsWordcloud', allTerms.slice(0, 100));
            createWordCloud('biotechWordcloud', biotechTerms.slice(0, 100));
            createWordCloud('nonBiotechWordcloud', nonBiotechTerms.slice(0, 100));
        }

        // Helper function to create a word cloud
        function createWordCloud(elementId, words) {
            // Clear previous word cloud
            d3.select(`#${elementId}`).html("");
            
            const element = document.getElementById(elementId);
            const width = element.offsetWidth;
            const height = element.offsetHeight;
            
            const layout = d3.layout.cloud()
                .size([width, height])
                .words(words)
                .padding(5)
                .rotate(() => ~~(Math.random() * 2) * 90)
                .fontSize(d => d.size)
                .on("end", draw);
                
            layout.start();
            
            function draw(words) {
                d3.select(`#${elementId}`)
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .append("g")
                    .attr("transform", `translate(${width / 2},${height / 2})`)
                    .selectAll("text")
                    .data(words)
                    .enter()
                    .append("text")
                    .style("font-size", d => `${d.size}px`)
                    .style("fill", () => d3.schemeCategory10[Math.floor(Math.random() * 10)])
                    .attr("text-anchor", "middle")
                    .attr("transform", d => `translate(${d.x},${d.y})rotate(${d.rotate})`)
                    .text(d => d.text);
            }
        }

        // Initialize insights tab
        function initInsights() {
            // Key statistics
            const totalCompanies = filteredData.length;
            const biotechCount = filteredData.filter(c => biotechVerticals.includes(c.vertical)).length;
            const academicCount = filteredData.filter(c => academicVerticals.includes(c.vertical)).length;
            const nonBiotechCount = filteredData.filter(c => nonBiotechVerticals.includes(c.vertical)).length;
            
            const verticalDistribution = {};
            filteredData.forEach(company => {
                const vertical = company.vertical;
                if (vertical) {
                    verticalDistribution[vertical] = (verticalDistribution[vertical] || 0) + 1;
                }
            });
            
            // Sort verticals by count
            const sortedVerticals = Object.entries(verticalDistribution)
                .sort((a, b) => b[1] - a[1]);
            
            const topVertical = sortedVerticals.length > 0 ? sortedVerticals[0][0] : 'None';
            const topVerticalCount = sortedVerticals.length > 0 ? sortedVerticals[0][1] : 0;
            
            // Display key statistics
            document.getElementById('keyStats').innerHTML = `
                <div class="row">
                    <div class="col-6">
                        <div class="border-bottom pb-2 mb-2">
                            <h6>Total Companies</h6>
                            <span class="fs-4 fw-bold">${totalCompanies}</span>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="border-bottom pb-2 mb-2">
                            <h6>Top Vertical</h6>
                            <span class="fs-4 fw-bold">${topVertical} (${topVerticalCount})</span>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-4">
                        <div class="text-center">
                            <h6>Biotech</h6>
                            <div class="fs-4 fw-bold">${biotechCount}</div>
                            <div class="text-muted">${Math.round(biotechCount / totalCompanies * 100)}%</div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="text-center">
                            <h6>Academic</h6>
                            <div class="fs-4 fw-bold">${academicCount}</div>
                            <div class="text-muted">${Math.round(academicCount / totalCompanies * 100)}%</div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="text-center">
                            <h6>Non-Biotech</h6>
                            <div class="fs-4 fw-bold">${nonBiotechCount}</div>
                            <div class="text-muted">${Math.round(nonBiotechCount / totalCompanies * 100)}%</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Populate vertical terms select
            const verticalTermsSelect = document.getElementById('verticalTermsSelect');
            verticalTermsSelect.innerHTML = '';
            
            sortedVerticals.forEach(([vertical, count]) => {
                const option = document.createElement('option');
                option.value = vertical;
                option.textContent = `${vertical} (${count})`;
                verticalTermsSelect.appendChild(option);
            });
            
            // Show terms for first vertical by default
            if (sortedVerticals.length > 0) {
                showVerticalTerms(sortedVerticals[0][0]);
            }
            
            // Add event listener for select change
            verticalTermsSelect.addEventListener('change', function() {
                showVerticalTerms(this.value);
            });
        }

        // Show common terms for a specific vertical
        function showVerticalTerms(vertical) {
            const verticalCompanies = filteredData.filter(c => c.vertical === vertical);
            const terms = {};
            const stopWords = new Set(['and', 'the', 'for', 'in', 'on', 'with', 'to', 'of', 'a', 'an']);
            
            verticalCompanies.forEach(company => {
                if (company.vertical_detail) {
                    const words = company.vertical_detail.toLowerCase()
                        .replace(/[^\w\s]/g, '')
                        .split(/\s+/)
                        .filter(word => word.length > 2 && !stopWords.has(word));
                    
                    words.forEach(word => {
                        terms[word] = (terms[word] || 0) + 1;
                    });
                }
            });
            
            // Sort and prepare data for terms
            const sortedTerms = Object.entries(terms)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 15); // Show top 15 terms
            
            // Create terms list
            const termsList = document.getElementById('verticalTermsList');
            if (sortedTerms.length === 0) {
                termsList.innerHTML = '<div class="alert alert-info">No common terms found for this vertical.</div>';
                return;
            }
            
            let termsHtml = '<div class="list-group">';
            sortedTerms.forEach(([term, count]) => {
                termsHtml += `
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        ${term}
                        <span class="badge bg-primary rounded-pill">${count}</span>
                    </div>
                `;
            });
            termsHtml += '</div>';
            
            termsList.innerHTML = termsHtml;
        }

        // Apply filters to data
        function applyFilters() {
            const verticalFilter = document.getElementById('verticalFilter').value;
            const detailSearch = document.getElementById('detailSearch').value.toLowerCase();
            
            // Filter data
            filteredData = companiesData.filter(company => {
                // Apply vertical filter
                if (verticalFilter !== 'all' && company.vertical !== verticalFilter) {
                    return false;
                }
                
                // Apply detail search
                if (detailSearch && company.vertical_detail && !company.vertical_detail.toLowerCase().includes(detailSearch)) {
                    return false;
                }
                
                return true;
            });
            
            // Update results count
            document.getElementById('resultsCount').textContent = `Showing ${filteredData.length} of ${companiesData.length} companies`;
            
            // Update visualizations
            initDataTable();
            initCharts();
            initWordClouds();
            initInsights();
        }

        // Process CSV data
        function processData(data) {
            companiesData = data;
            filteredData = data;
            
            // Update results count
            document.getElementById('resultsCount').textContent = `Showing ${filteredData.length} of ${companiesData.length} companies`;
            
            // Initialize all visualizations
            initDataTable();
            initCharts();
            initWordClouds();
            initInsights();
            
            // Show dashboard content
            document.getElementById('dashboardContent').classList.remove('d-none');
        }

        // Parse CSV file
        function parseCSV(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const csv = e.target.result;
                    
                    Papa.parse(csv, {
                        header: true,
                        skipEmptyLines: true,
                        complete: function(results) {
                            resolve(results.data);
                        },
                        error: function(error) {
                            reject(error);
                        }
                    });
                };
                
                reader.onerror = function() {
                    reject(new Error('Error reading file'));
                };
                
                reader.readAsText(file);
            });
        }

        // Load sample data
        function loadSampleData() {
            // Create sample data with 50 companies
            const sampleData = [
                { "Company Name": "BioPharma Inc", "Company URL": "https://biopharma.example.com", "vertical": "Therapeutics", "vertical_detail": "Developing antibody-based therapies for cancer and autoimmune diseases" },
                { "Company Name": "GeneTech Solutions", "Company URL": "https://genetech.example.com", "vertical": "Therapeutics", "vertical_detail": "Gene therapy platform focused on rare genetic disorders" },
                { "Company Name": "MediDev Corp", "Company URL": "https://medidev.example.com", "vertical": "Medical Devices", "vertical_detail": "Wearable monitoring devices for cardiovascular patients" },
                { "Company Name": "LabTools Pro", "Company URL": "https://labtoolspro.example.com", "vertical": "Research Tools & Lab Equipment", "vertical_detail": "Advanced flow cytometry instruments for research laboratories" },
                { "Company Name": "Diagnostic Precision", "Company URL": "https://diagnosticprecision.example.com", "vertical": "Diagnostics", "vertical_detail": "Molecular diagnostic tests for infectious diseases" },
                { "Company Name": "BioDataSystems", "Company URL": "https://biodatasystems.example.com", "vertical": "Bioinformatics & Computational Tools", "vertical_detail": "AI-driven drug discovery platform for target identification" },
                { "Company Name": "CellCore Therapeutics", "Company URL": "https://cellcore.example.com", "vertical": "Therapeutics", "vertical_detail": "CAR-T cell therapy development for solid tumors" },
                { "Company Name": "HealthTech Solutions", "Company URL": "https://healthtech.example.com", "vertical": "Digital Health & Health IT", "vertical_detail": "Telemedicine platform with AI-assisted diagnostics" },
                { "Company Name": "LabEquip Supply", "Company URL": "https://labequip.example.com", "vertical": "Research Tools & Lab Equipment", "vertical_detail": "Laboratory consumables and reagents for genomics research" },
                { "Company Name": "BioManufacturing Inc", "Company URL": "https://biomanufacturing.example.com", "vertical": "CROs & CDMOs", "vertical_detail": "Contract manufacturing of biologics and cell therapies" },
                { "Company Name": "State University Medical Center", "Company URL": "https://sumc.example.edu", "vertical": "Academic & Research Institutions", "vertical_detail": "Research institution - Neuroscience and genomics" },
                { "Company Name": "MedConsult Partners", "Company URL": "https://medconsult.example.com", "vertical": "Clinical & Regulatory Consulting", "vertical_detail": "Regulatory strategy for biologics and advanced therapies" },
                { "Company Name": "Advanced Protein Systems", "Company URL": "https://advancedprotein.example.com", "vertical": "Research Tools & Lab Equipment", "vertical_detail": "Protein analysis tools and antibody production services" },
                { "Company Name": "NanoMed Technologies", "Company URL": "https://nanomed.example.com", "vertical": "Therapeutics", "vertical_detail": "Nanoparticle drug delivery for cancer therapeutics" },
                { "Company Name": "BioIndustrial Products", "Company URL": "https://bioindustrial.example.com", "vertical": "Industrial Biotech", "vertical_detail": "Enzymatic processes for sustainable chemical manufacturing" },
                { "Company Name": "Medical Imaging Innovations", "Company URL": "https://medicalimaging.example.com", "vertical": "Diagnostics", "vertical_detail": "Advanced imaging technology for early cancer detection" },
                { "Company Name": "Tech Solutions Inc", "Company URL": "https://techsolutions.example.com", "vertical": "Technology/IT", "vertical_detail": "Enterprise software solutions for healthcare organizations" },
                { "Company Name": "BioPharma Consultants", "Company URL": "https://biopharmaconsultants.example.com", "vertical": "Professional Services", "vertical_detail": "Business strategy consulting for biotech startups" },
                { "Company Name": "Healthcare Network", "Company URL": "https://healthcarenetwork.example.com", "vertical": "Healthcare Services", "vertical_detail": "Specialized clinics for chronic disease management" },
                { "Company Name": "Implant Technologies", "Company URL": "https://implanttech.example.com", "vertical": "Medical Devices", "vertical_detail": "Bioresorbable implants for orthopedic applications" },
                // Add more sample data to make 50 entries
                { "Company Name": "RNA Therapeutics", "Company URL": "https://rnatherapeutics.example.com", "vertical": "Therapeutics", "vertical_detail": "siRNA-based therapeutics for liver diseases" },
                { "Company Name": "Genomic Diagnostics Lab", "Company URL": "https://genomicdiagnostics.example.com", "vertical": "Diagnostics", "vertical_detail": "Next-generation sequencing tests for oncology" },
                { "Company Name": "Clinical Trial Services", "Company URL": "https://clinicaltrialservices.example.com", "vertical": "CROs & CDMOs", "vertical_detail": "Clinical trial management for phase I-III studies" },
                { "Company Name": "BioInformatics Solutions", "Company URL": "https://bioinformatics.example.com", "vertical": "Bioinformatics & Computational Tools", "vertical_detail": "Genomic data analysis software for research labs" },
                { "Company Name": "Patient Monitoring Systems", "Company URL": "https://patientmonitoring.example.com", "vertical": "Digital Health & Health IT", "vertical_detail": "Remote patient monitoring for chronic conditions" },
                { "Company Name": "Synthetic Biology Corp", "Company URL": "https://syntheticbiology.example.com", "vertical": "General Biotech", "vertical_detail": "Engineered microorganisms for various applications" },
                { "Company Name": "Bioethanol Production", "Company URL": "https://bioethanol.example.com", "vertical": "Industrial Biotech", "vertical_detail": "Bioprocessing for sustainable fuel production" },
                { "Company Name": "Research Institute of Biology", "Company URL": "https://researchbiology.example.org", "vertical": "Academic & Research Institutions", "vertical_detail": "Research institution - Systems biology and synthetic biology" },
                { "Company Name": "Surgical Instruments Co", "Company URL": "https://surgicalinstruments.example.com", "vertical": "Medical Devices", "vertical_detail": "Minimally invasive surgical tools with robotics" },
                { "Company Name": "Health Insurance Provider", "Company URL": "https://healthinsurance.example.com", "vertical": "Healthcare Services", "vertical_detail": "Health insurance plans with preventive care focus" },
                { "Company Name": "Laboratory Software", "Company URL": "https://labsoftware.example.com", "vertical": "Technology/IT", "vertical_detail": "LIMS and laboratory workflow management software" },
                { "Company Name": "Biotech Legal Advisors", "Company URL": "https://biotechlegal.example.com", "vertical": "Professional Services", "vertical_detail": "IP protection and patenting for biotech innovations" },
                { "Company Name": "Sustainable Materials", "Company URL": "https://sustainablematerials.example.com", "vertical": "Manufacturing", "vertical_detail": "Bio-based materials for packaging applications" },
                { "Company Name": "Natural Products Co", "Company URL": "https://naturalproducts.example.com", "vertical": "Consumer Goods", "vertical_detail": "Plant-based nutritional supplements and cosmetics" },
                { "Company Name": "Biotech Venture Capital", "Company URL": "https://biotechvc.example.com", "vertical": "Financial Services", "vertical_detail": "Investment fund focused on early-stage biotech startups" },
                { "Company Name": "Bioenergy Solutions", "Company URL": "https://bioenergy.example.com", "vertical": "Energy", "vertical_detail": "Biofuel production from agricultural waste" },
                { "Company Name": "Life Science Media", "Company URL": "https://lifesciencemedia.example.com", "vertical": "Media & Entertainment", "vertical_detail": "Digital publication covering biotech industry news" },
                { "Company Name": "Public Health Department", "Company URL": "https://publichealth.example.gov", "vertical": "Government & Public Sector", "vertical_detail": "Government agency for disease prevention and health promotion" },
                { "Company Name": "Waste Recycling Biotech", "Company URL": "https://wasterecycling.example.com", "vertical": "Environmental Services", "vertical_detail": "Biotechnology for waste treatment and recycling" },
                { "Company Name": "Pharma Manufacturing Facility", "Company URL": "https://pharmamanufacturing.example.com", "vertical": "Real Estate & Construction", "vertical_detail": "GMP-compliant facility design and construction for pharmaceuticals" },
                { "Company Name": "Biotech Training Institute", "Company URL": "https://biotechtraining.example.com", "vertical": "Education & Training", "vertical_detail": "Professional development courses for biotech workforce" },
                { "Company Name": "Biologics Logistics", "Company URL": "https://biologicslogistics.example.com", "vertical": "Transportation & Logistics", "vertical_detail": "Cold chain logistics for biological samples and therapies" },
                { "Company Name": "Rare Disease Foundation", "Company URL": "https://raredisease.example.org", "vertical": "Non-Profit & Advocacy", "vertical_detail": "Patient advocacy and research funding for rare genetic disorders" },
                { "Company Name": "Therapeutic Antibodies", "Company URL": "https://therapeuticantibodies.example.com", "vertical": "Therapeutics", "vertical_detail": "Monoclonal antibody development for oncology" },
                { "Company Name": "Protein Engineering", "Company URL": "https://proteinengineering.example.com", "vertical": "Therapeutics", "vertical_detail": "Engineered protein therapeutics for metabolic disorders" },
                { "Company Name": "Drug Discovery Tools", "Company URL": "https://drugdiscoverytools.example.com", "vertical": "Research Tools & Lab Equipment", "vertical_detail": "High-throughput screening platforms for drug discovery" },
                { "Company Name": "Companion Diagnostics", "Company URL": "https://companiondiagnostics.example.com", "vertical": "Diagnostics", "vertical_detail": "Biomarker tests for precision medicine applications" },
                { "Company Name": "Medical Wearables", "Company URL": "https://medicalwearables.example.com", "vertical": "Medical Devices", "vertical_detail": "Continuous glucose monitoring devices for diabetes management" },
                { "Company Name": "Drug Development Services", "Company URL": "https://drugdevelopment.example.com", "vertical": "CROs & CDMOs", "vertical_detail": "Preclinical testing and drug formulation services" },
                { "Company Name": "Genomic Informatics", "Company URL": "https://genomicinformatics.example.com", "vertical": "Bioinformatics & Computational Tools", "vertical_detail": "Population genomics and variant interpretation software" }
            ];
            
            // Show loading spinner
            document.querySelector('.loading').style.display = 'block';
            
            // Process sample data
            setTimeout(() => {
                processData(sampleData);
                document.querySelector('.loading').style.display = 'none';
                document.getElementById('uploadStatus').textContent = 'Sample data loaded successfully!';
                document.getElementById('uploadStatus').classList.remove('d-none', 'alert-danger');
                document.getElementById('uploadStatus').classList.add('alert-success');
            }, 500);
        }

        // Document ready
        document.addEventListener('DOMContentLoaded', function() {
            // Load CSV button click handler
            document.getElementById('loadCsvBtn').addEventListener('click', function() {
                const fileInput = document.getElementById('csvFile');
                const file = fileInput.files[0];
                
                if (!file) {
                    document.getElementById('uploadStatus').textContent = 'Please select a CSV file first.';
                    document.getElementById('uploadStatus').classList.remove('d-none', 'alert-success');
                    document.getElementById('uploadStatus').classList.add('alert-danger');
                    return;
                }
                
                // Show loading spinner
                document.querySelector('.loading').style.display = 'block';
                
                // Parse CSV file
                parseCSV(file)
                    .then(data => {
                        if (data.length === 0) {
                            throw new Error('No data found in CSV file.');
                        }
                        
                        // Process data
                        processData(data);
                        
                        // Update status
                        document.getElementById('uploadStatus').textContent = 'CSV file loaded successfully!';
                        document.getElementById('uploadStatus').classList.remove('d-none', 'alert-danger');
                        document.getElementById('uploadStatus').classList.add('alert-success');
                    })
                    .catch(error => {
                        document.getElementById('uploadStatus').textContent = `Error: ${error.message}`;
                        document.getElementById('uploadStatus').classList.remove('d-none', 'alert-success');
                        document.getElementById('uploadStatus').classList.add('alert-danger');
                    })
                    .finally(() => {
                        document.querySelector('.loading').style.display = 'none';
                    });
            });
            
            // Load sample data button click handler
            document.getElementById('loadSampleBtn').addEventListener('click', loadSampleData);
            
            // Apply filters button click handler
            document.getElementById('applyFiltersBtn').addEventListener('click', applyFilters);
            
            // Reset filters button click handler
            document.getElementById('resetFiltersBtn').addEventListener('click', function() {
                document.getElementById('verticalFilter').value = 'all';
                document.getElementById('detailSearch').value = '';
                
                // Reset filters
                filteredData = companiesData;
                document.getElementById('resultsCount').textContent = `Showing ${filteredData.length} of ${companiesData.length} companies`;
                
                // Update visualizations
                initDataTable();
                initCharts();
                initWordClouds();
                initInsights();
            });
        });
    </script>
</body>
</html>